import os
import subprocess
import sys
import time
from watchdog.events import FileSystemEventHandler
from watchdog.observers import Observer

homepath = os.path.expanduser("~")
repos_root = os.path.join(homepath, u'gitcluster', u'working')

for s in sys.argv:
    repos_root = s

class ReloadEventHandler(FileSystemEventHandler):
    def dispatch(self, event):
        print 'pushing from ' + repos_root
        subprocess.call([ os.path.join(homepath, u'bin', u'gtfc-push'), repos_root ])

print 'watching ' + repos_root

observer = Observer()
observer.daemon = True
observer.schedule(ReloadEventHandler(), repos_root, recursive=True)
observer.start()

while True:
    time.sleep(10)
