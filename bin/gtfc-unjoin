#!/bin/sh

# On the node you want to remove

. ${HOME}/bin/gtfc-keygen
export FOLDER=$1
. ${HOME}/bin/gtfc-parsefolder

[ -d ${FOLDER} ] || exit 1

cd ${FOLDER}

# remove myself
cat ${FOLDER}/.authorized_keys2 | grep -v "`whoami`@`hostname`$" > ${HOME}/.ssh/authorized_keys2

# copy and push
install -C ${HOME}/.ssh/authorized_keys2 ${FOLDER}/.authorized_keys2

sh ${HOME}/bin/gtfc-addandpush ${FOLDER}
