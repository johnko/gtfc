#!/bin/sh

# On the node you want to remove

. ${HOME}/bin/gtfc-keygen
export LOCALFOLDER=$1
. ${HOME}/bin/gtfc-parselocalfolder

[ -d ${LOCALFOLDER} ] || exit 1

cd ${LOCALFOLDER}

# remove myself
cat ${LOCALFOLDER}/.gitcluster.ssh/authorized_keys2 | grep -v "`whoami`@`hostname`$" > ${HOME}/.ssh/authorized_keys2

# copy and push
install -C ${HOME}/.ssh/authorized_keys2 ${LOCALFOLDER}/.gitcluster.ssh/authorized_keys2

sh ${HOME}/bin/gtfc-push ${LOCALFOLDER}
