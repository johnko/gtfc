#!/bin/sh

# Usage:
# gtfc-keygen

[ -f ${HOME}/.ssh/id_ed25519 ] \
    || ssh-keygen -N '' -t ed25519 -f ${HOME}/.ssh/id_ed25519

if [ ! -e ${HOME}/.ssh/gtfc.authorized_keys2 ]; then
    cat >${HOME}/.ssh/gtfc.authorized_keys2 <<EOF
command="${HOME}/bin/gtfc-shell" `cat ${HOME}/.ssh/id_ed25519.pub`
EOF
    vi ${HOME}/.ssh/gtfc.authorized_keys2
fi

if [ ! -e ${HOME}/.ssh/gtfc.config ]; then
    cat >${HOME}/.ssh/gtfc.config <<EOF
Host `hostname`
    HostName `net-ip`
    Port 22
    User `whoami`
EOF
    vi ${HOME}/.ssh/gtfc.config
fi

gtfc-allowauthkey1
