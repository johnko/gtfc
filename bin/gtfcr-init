#!/bin/sh

# gtfc init

gitcluster_init() {
  MYUSER1="urep"
  PEERPORT1="22"
  TOSPLIT=$1
  repo=$2
  if grep '@' ${TOSPLIT} >/dev/null 2>&1 ; then
    if [ "x" != "x${TOSPLIT%@*}" ]; then
      MYUSER1="${TOSPLIT%@*}"
    fi
  fi
  HOSTANDPORT1="${TOSPLIT#*@}"
  if [ "x" != "x${HOSTANDPORT1%:*}" ]; then
    HOST1="${HOSTANDPORT1%:*}"
  fi
  if grep ':' ${HOSTANDPORT1} >/dev/null 2>&1 ; then
    if [ "x" != "${HOSTANDPORT1#*:}" ]; then
      PEERPORT1="${HOSTANDPORT1#*:}"
    fi
  fi
  if [ "x" = "x$HOST1" ]; then
    echo "ERROR: missing host1" >&2
    exit 1
  elif [ "x" = "x$repo" ]; then
    repo="~/gitsync"
  fi
  ssh -t -p $PEERPORT1 $MYUSER1@$HOST1 "gtfc init $1 $repo"

}

gitcluster_init $1 $2
