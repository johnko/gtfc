#!/bin/sh

# gtfc-bootstrap folder

. ${HOME}/bin/gtfc-keygen
export FOLDER=$1
. ${HOME}/bin/gtfc-parsefolder

git config user.email "`whoami`@`hostname -s`.gtfc.local" >/dev/null 2>&1
git config user.name "`whoami`" >/dev/null 2>&1

[ -d ${FOLDER} ] || git init --separate-git-dir=${GITPACKDIR} ${FOLDER}
[ -d ${FOLDER} ] || exit 1

cd ${FOLDER}


# add my pubkey to existing cluster (i am the first node)
install -C ${HOME}/.ssh/gtfc.authorized_keys2  ${FOLDER}/.authorized_keys2
install -C ${HOME}/.ssh/gtfc.authorized_keys2  ${HOME}/.ssh/authorized_keys2
# add my config to existing cluster (i am the first node)
install -C ${HOME}/.ssh/gtfc.config  ${FOLDER}/.sshconfig
install -C ${HOME}/.ssh/gtfc.config  ${HOME}/.ssh/config

git add --all .
git commit -a -m "initial commit - `whoami`@`hostname`" >/dev/null 2>&1
